'use strict';
var debug = require('debug')('basepage');
var util = require('util');
var fs = require('fs');
var path = require('path');
var async = require('async');
var tool = require('leaptool');

module.exports = function(app, module_name, dataModule) {

  var data = dataModule;
  var block = { data:dataModule };
  var page = {};

  //show html page, used in web module for route /page/:page_name
  block.showPage = function(req, res) {
    var parameter = tool.getReqParameter(req);
    var module_name = parameter['module_name'] || 'web';
    var page_name = parameter['page_name'] || 'index';
    var pageTitle = parameter['title'] || 'home';
    var page = app.getPage(req, {
      module_name: module_name,
      page_name: page_name,
      title: pageTitle
    });
    res.render([module_name, page_name + '.html'].join('/'), {
      app: app, req: req, page: page
    });
  };

  block.checkLogin = function(req, res, next) {
      if (req.session && req.session.user) {
          next();
      } else {
          var url = '/user/login?url=' + req.url;
          res.redirect(url);
      }
  };

  return block;
};
